<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>â—¥ ãƒ„Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ø®Ø§ØµÙ‡ Ø£Ù„ Ø¨ÙƒØ§Ø± Ø§Ù„Ø²Ø¹Ø¨ÙŠãƒ„ â—¤</title>
  <!-- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· "Cairo" Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --icon-bg: linear-gradient(135deg, #66BB6A, #388E3C);
      --icon-bg-hover: linear-gradient(135deg, #4CAF50, #2E7D32);
      --button-bg: #4CAF50;
    }
    body {
      font-family: 'Cairo', sans-serif;
    }
    /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    #loginOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: white;
    }
    .login-container {
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      width: 320px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      color: #333;
    }
    .login-container h2 { margin-bottom: 20px; }
    .role-options {
      margin: 20px 0;
      display: flex;
      justify-content: space-around;
    }
    .role-btn {
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: box-shadow 0.2s;
    }
    .role-btn.active { box-shadow: 0 0 10px rgba(0,0,0,0.5); }
    .admin-btn { background: #007BFF; color: #fff; }
    .editor-btn { background: #28A745; color: #fff; }
    .visitor-btn { background: #6C757D; color: #fff; }
    .login-btn {
      padding: 10px 20px;
      background: #007BFF;
      border: none;
      border-radius: 5px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
    }
    #passwordContainer { margin-top: 10px; }
    #passwordInput {
      width: 80%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    #loginError { color: red; margin-top: 10px; font-size: 14px; display: none; }
    .login-links {
      margin-top: 15px;
      font-size: 14px;
    }
    .login-links a {
      text-decoration: none;
      margin: 0 5px;
      color: #007BFF;
    }
    .login-links a:hover { text-decoration: underline; }
    
    /* Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„ØµÙØ­Ø© */
    html, body {
      margin: 0;
      padding: 0;
      background-color: #e3f2fd;
      text-align: center;
      overflow-x: auto;
    }
    body {
      margin-top: 120px;
      padding: 20px;
    }
    
    /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
    #controlPanel {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #ffffff;
      padding: 12px 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      text-align: center;
      z-index: 1001;
    }
    #controlPanel button {
      display: block;
      width: 100%;
      margin: 6px 0;
      font-size: 14px;
      padding: 6px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #controlPanel button:hover { opacity: 0.9; }
    #zoomControls button {
      width: 45%;
      display: inline-block;
      margin: 0 2%;
    }
    #toggleColorPanelBtn { background: #FF9800; color: #fff; }
    #backBtn { background: #2196F3; color: #fff; }
    /* Ù„ÙˆØ­Ø© ØªØºÙŠÙŠØ± Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
    #colorPanel {
      display: none;
      margin-top: 10px;
      padding: 10px;
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 5px;
      width: 260px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }
    #colorPanel span { font-weight: bold; margin-right: 10px; }
    .color-btn {
      width: 40px;
      height: 40px;
      border: 2px solid #fff;
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      display: inline-block;
      margin: 5px;
    }
    .color-btn:hover { transform: scale(1.1); box-shadow: 0 0 8px rgba(0,0,0,0.3); }
    
    /* Ø§Ù„Ø´Ø¬Ø±Ø© */
    .tree {
      display: inline-block;
      position: relative;
      padding: 20px;
    }
    .tree ul {
      padding-top: 20px;
      position: relative;
      margin: 0 auto;
      white-space: nowrap;
    }
    .tree ul::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: #8B4513;
      border-radius: 2px;
    }
    .tree > ul::before { display: none; }
    .tree li {
      list-style-type: none;
      position: relative;
      padding-top: 20px;
      display: inline-block;
      vertical-align: top;
      text-align: center;
      margin: 0 20px;
    }
    .tree li::before {
      content: "";
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 20px;
      background: #8B4513;
      border-radius: 1px;
    }
    .tree > ul > li::before { display: none; }
    .member-box {
      padding: 8px 12px;
      background: var(--icon-bg);
      color: white;
      border-radius: 50% 30% / 30% 50%;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
      display: inline-block;
      transition: transform 0.2s, background 0.3s;
    }
    .member-box:hover { transform: scale(1.1); background: var(--icon-bg-hover); }
    .add-child-btn {
      margin-top: 5px;
      background-color: var(--button-bg);
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .add-child-btn::before { content: "ğŸƒ "; }
    
    /* Ø§Ù„Ù†ÙˆØ§ÙØ° */
    .info-box {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      text-align: center;
      z-index: 3000;
      width: 300px;
    }
    .info-box img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin-bottom: 10px;
    }
    .close-btn, .edit-btn {
      background: #f44336;
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 10px;
    }
    .edit-btn { background: #4CAF50; margin-right: 5px; }
    #editForm, #addChildForm { display: none; margin-top: 10px; }
    #editForm input, #addChildForm input {
      margin: 5px;
      padding: 5px;
      width: 80%;
    }
    #editForm button, #addChildForm button {
      margin: 5px;
      padding: 5px 10px;
      cursor: pointer;
    }
    
    /* Ø§Ù„Ø¢ÙŠØ© ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† */
    #fixedVerse {
      margin-bottom: 20px;
      font-size: 16px;
      color: #6d4c41;
      background: #fff3e0;
      padding: 10px;
      border: 2px solid #8B4513;
      border-radius: 10px;
      width: 90%;
      margin: 0 auto 20px auto;
      line-height: 1.4;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    #fixedVerse p { margin: 4px 0; }
    #mainTitle {
      font-size: 32px;
      font-weight: bold;
      color: #2c3e50;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <div id="controlPanel">
    <button id="grantPermissionsBtn" onclick="openPermissionsModal()">Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button>
    <div id="zoomControls">
      <button id="zoomInBtn" onclick="zoomIn()">ØªÙƒØ¨ÙŠØ±</button>
      <button id="zoomOutBtn" onclick="zoomOut()">ØªØµØºÙŠØ±</button>
    </div>
    <button id="toggleColorPanelBtn" onclick="toggleColorPanel()">ØªØºÙŠÙŠØ± Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª</button>
    <div id="colorPanel">
      <span>Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†:</span>
      <div class="color-btn" style="background: linear-gradient(135deg, #66BB6A, #388E3C);" onclick="changeIconColor('#66BB6A', '#388E3C')"></div>
      <div class="color-btn" style="background: linear-gradient(135deg, #42A5F5, #1E88E5);" onclick="changeIconColor('#42A5F5', '#1E88E5')"></div>
      <div class="color-btn" style="background: linear-gradient(135deg, #FF7043, #D84315);" onclick="changeIconColor('#FF7043', '#D84315')"></div>
      <div class="color-btn" style="background: linear-gradient(135deg, #AB47BC, #8E24AA);" onclick="changeIconColor('#AB47BC', '#8E24AA')"></div>
      <div class="color-btn" style="background: linear-gradient(135deg, #FFA726, #FB8C00);" onclick="changeIconColor('#FFA726', '#FB8C00')"></div>
    </div>
    <button id="backBtn" onclick="goBack()">Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ -->
  <div id="permissionsModal" class="info-box" style="width: 320px;">
    <h2>ØªØ¹Ø¯ÙŠÙ„ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <p>ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¹Ø§Ù…:</p>
    <input type="text" id="newAdminCode" value="111111"><br>
    <p>ÙƒÙˆØ¯ Ø§Ù„Ù…Ø­Ø±Ø±:</p>
    <input type="text" id="newEditorCode" value="123456"><br>
    <p>ÙƒÙˆØ¯ Ø§Ù„Ø²Ø§Ø¦Ø±:</p>
    <input type="text" id="newVisitorCode" value="1212"><br>
    <p>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§ØªØµÙ„ Ø¨Ù†Ø§):</p>
    <input type="text" id="newContactNumber" value="0123456789"><br>
    <p>Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ (Ù„Ø·Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯):</p>
    <input type="text" id="newWhatsAppNumber" value="0123456789"><br>
    <button onclick="savePermissions()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
    <button onclick="closePermissionsModal()">Ø¥Ù„ØºØ§Ø¡</button>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginOverlay">
    <div class="login-container">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <div class="role-options">
        <button class="role-btn admin-btn" data-role="admin" onclick="selectRole(this)">Ù…Ø´Ø±Ù Ø¹Ø§Ù…</button>
        <button class="role-btn editor-btn" data-role="editor" onclick="selectRole(this)">Ù…Ø­Ø±Ø±</button>
        <button class="role-btn visitor-btn" data-role="visitor" onclick="selectRole(this)">Ø²Ø§Ø¦Ø±</button>
      </div>
      <div id="passwordContainer">
        <input type="password" id="passwordInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ">
      </div>
      <button class="login-btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
      <p id="loginError"></p>
      <div class="login-links">
        <a id="forgotLink" href="#" onclick="alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¯Ø¹Ù…'); return false;">Ù†Ø³ÙŠØª Ø§Ù„ÙƒÙˆØ¯</a> |
        <a id="contactLink" href="tel:0123456789">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a> |
        <a id="whatsAppLink" href="https://wa.me/0123456789">Ø§Ø·Ù„Ø¨ ÙƒÙˆØ¯ Ù„Ù„Ø¯Ø®ÙˆÙ„</a>
      </div>
    </div>
  </div>
  
  <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (ÙŠØ¸Ù‡Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ø¢ÙŠØ©) -->
  <div id="mainTitle">â—¥ ãƒ„Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ø®Ø§ØµÙ‡ Ø£Ù„ Ø¨ÙƒØ§Ø± Ø§Ù„Ø²Ø¹Ø¨ÙŠãƒ„ â—¤</div>
  
  <!-- Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© -->
  <div class="tree" id="treeRoot">
    <div id="fixedVerse">
      <p>ï·½</p>
      <p>ÙŠÙØ§ Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù Ø¥ÙÙ†Ù‘ÙØ§ Ø®ÙÙ„ÙÙ‚Ù’Ù†ÙØ§ÙƒÙÙ…</p>
      <p>Ù…Ù‘ÙÙ† Ø°ÙÙƒÙØ±Ù ÙˆÙØ£ÙÙ†Ø«ÙÙ‰Ù° ÙˆÙØ¬ÙØ¹ÙÙ„Ù’Ù†ÙØ§ÙƒÙÙ…Ù’ Ø´ÙØ¹ÙÙˆØ¨Ù‹Ø§ ÙˆÙÙ‚ÙØ¨ÙØ§Ø¦ÙÙ„Ù Ù„ÙØªÙØ¹ÙØ§Ø±ÙÙÙÙˆØ§ Ûš Ø¥ÙÙ†Ù‘Ù Ø£ÙÙƒÙ’Ø±ÙÙ…ÙÙƒÙÙ…Ù’ Ø¹ÙÙ†Ø¯Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø£ÙØªÙ’Ù‚ÙØ§ÙƒÙÙ…Ù’ Ûš Ø¥ÙÙ†Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø¹ÙÙ„ÙÙŠÙ…ÙŒ Ø®ÙØ¨ÙÙŠØ±ÙŒ</p>
      <p>ØµØ¯Ù‚ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…</p>
      <div id="mainTitle">â—¥ ãƒ„Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ø®Ø§ØµÙ‡ Ø£Ù„ Ø¨ÙƒØ§Ø± Ø§Ù„Ø²Ø¹Ø¨ÙŠãƒ„ â—¤</div>
    </div>
    <ul id="rootUL">
      <li data-id="1" data-parent="null"
          data-name="Ø§Ù„Ø¬Ø¯ Ù…Ø­Ù…Ø¯" data-birth="1920"
          data-death="2000" data-location="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©"
          data-image="https://via.placeholder.com/100">
        <div class="member-box" onclick="showInfo(this)">Ø§Ù„Ø¬Ø¯ Ù…Ø­Ù…Ø¯</div>
        <br>
        <button class="add-child-btn" onclick="openAddChildForm(this)">ğŸƒ Ø¥Ø¶Ø§ÙØ© Ø§Ø¨Ù†</button>
        <ul>
          <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
        </ul>
      </li>
    </ul>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆÙ†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ­Ø±ÙŠØ± -->
  <div id="infoBox" class="info-box">
    <img id="infoImage" src="" alt="ØµÙˆØ±Ø©">
    <h2 id="infoName"></h2>
    <p>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯: <span id="infoBirth"></span></p>
    <p>âš°ï¸ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙØ§Ø©: <span id="infoDeath"></span></p>
    <p>ğŸ“ Ù…ÙƒØ§Ù† Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©: <span id="infoLocation"></span></p>
    <button class="edit-btn" id="editBtn" onclick="openEditForm()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
    <button class="close-btn" onclick="closeInfo()">Ø¥ØºÙ„Ø§Ù‚</button>
    <div id="editForm">
      <input type="text" id="editName" placeholder="Ø§Ù„Ø§Ø³Ù…"><br>
      <input type="text" id="editBirth" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯"><br>
      <input type="text" id="editDeath" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙØ§Ø©"><br>
      <input type="text" id="editLocation" placeholder="Ù…ÙƒØ§Ù† Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©"><br>
      <!-- Ø®Ø§Ù†Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² -->
      <input type="file" id="editImageFile" accept="image/*"><br>
      <button onclick="saveEdit()">Ø­ÙØ¸</button>
      <button onclick="closeEditForm()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø§Ø¨Ù† -->
  <div id="addChildForm" class="info-box">
    <h2>Ø¥Ø¶Ø§ÙØ© Ø§Ø¨Ù†</h2>
    <input type="text" id="childName" placeholder="Ø§Ù„Ø§Ø³Ù…"><br>
    <input type="text" id="childBirth" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯"><br>
    <input type="text" id="childDeath" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙØ§Ø©"><br>
    <input type="text" id="childLocation" placeholder="Ù…ÙƒØ§Ù† Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©"><br>
    <input type="text" id="childImage" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©"><br>
    <button onclick="saveChild()">Ø­ÙØ¸</button>
    <button onclick="closeAddChildForm()">Ø¥Ù„ØºØ§Ø¡</button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† localStorage Ø¥Ù† ÙˆÙØ¬Ø¯Øª
      if(localStorage.getItem("adminCode")) {
        adminCode = localStorage.getItem("adminCode");
      } else { adminCode = "111111"; }
      if(localStorage.getItem("editorCode")) {
        editorCode = localStorage.getItem("editorCode");
      } else { editorCode = "123456"; }
      if(localStorage.getItem("visitorCode")) {
        visitorCode = localStorage.getItem("visitorCode");
      } else { visitorCode = "1212"; }
      if(localStorage.getItem("contactNumber")) {
        contactNumber = localStorage.getItem("contactNumber");
        document.getElementById("contactLink").href = "tel:" + contactNumber;
      }
      if(localStorage.getItem("whatsAppNumber")) {
        whatsAppNumber = localStorage.getItem("whatsAppNumber");
        document.getElementById("whatsAppLink").href = "https://wa.me/" + whatsAppNumber;
        document.getElementById("whatsAppLink").innerText = "Ø§Ø·Ù„Ø¨ ÙƒÙˆØ¯ Ù„Ù„Ø¯Ø®ÙˆÙ„";
      }
      
      /***************** Ø§Ù„ØªÙƒØ¨ÙŠØ±/Ø§Ù„ØªØµØºÙŠØ± *******************/
      let currentScale = 1;
      window.zoomIn = function() {
        currentScale += 0.1;
        document.querySelector('.tree').style.transform = `scale(${currentScale})`;
        document.querySelector('.tree').style.transformOrigin = 'top center';
      };
      window.zoomOut = function() {
        if(currentScale > 0.2) {
          currentScale -= 0.1;
          document.querySelector('.tree').style.transform = `scale(${currentScale})`;
          document.querySelector('.tree').style.transformOrigin = 'top center';
        }
      };
      
      /***************** ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ *******************/
      window.userRole = "visitor";
      window.selectedRole = "";
      window.selectRole = function(btn) {
        selectedRole = btn.getAttribute("data-role");
        document.querySelectorAll(".role-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById("passwordContainer").style.display = "block";
        const err = document.getElementById("loginError");
        err.style.display = "none"; err.innerText = "";
      };
      window.login = function() {
        if(!selectedRole) {
          showError("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆØ±");
          return;
        }
        const pass = document.getElementById("passwordInput").value.trim();
        if(selectedRole === "admin" && pass !== adminCode) {
          showError("Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­ Ù„Ù„Ù…Ø´Ø±Ù");
          return;
        } else if(selectedRole === "editor" && pass !== editorCode) {
          showError("Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­ Ù„Ù„Ù…Ø­Ø±Ø±");
          return;
        } else if(selectedRole === "visitor" && pass !== visitorCode) {
          showError("Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­ Ù„Ù„Ø²Ø§Ø¦Ø±");
          return;
        }
        userRole = selectedRole;
        document.getElementById("loginOverlay").style.display = "none";
        updatePermissions();
      };
      window.showError = function(msg) {
        const err = document.getElementById("loginError");
        err.innerText = msg;
        err.style.display = "block";
      };
      window.updatePermissions = function() {
        const addBtns = document.querySelectorAll(".add-child-btn");
        const editBtn = document.getElementById("editBtn");
        const grantBtn = document.getElementById("grantPermissionsBtn");
        if(userRole === "visitor") {
          addBtns.forEach(btn => btn.style.display = "none");
          editBtn.style.display = "none";
          grantBtn.style.display = "none";
        } else {
          addBtns.forEach(btn => btn.style.display = "inline-block");
          editBtn.style.display = "inline-block";
          grantBtn.style.display = (userRole === "admin") ? "inline-block" : "none";
        }
      };
      window.logout = function() {
        window.location.reload();
      };
      window.goBack = function() {
        window.location.reload();
      };
      
      /***************** ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ *******************/
      window.openPermissionsModal = function() {
        if(userRole !== "admin") return;
        document.getElementById("permissionsModal").style.display = "block";
      };
      window.closePermissionsModal = function() {
        document.getElementById("permissionsModal").style.display = "none";
      };
      window.savePermissions = function() {
        adminCode = document.getElementById("newAdminCode").value.trim() || adminCode;
        editorCode = document.getElementById("newEditorCode").value.trim() || editorCode;
        visitorCode = document.getElementById("newVisitorCode").value.trim() || visitorCode;
        contactNumber = document.getElementById("newContactNumber").value.trim() || contactNumber;
        whatsAppNumber = document.getElementById("newWhatsAppNumber").value.trim() || whatsAppNumber;
        document.getElementById("contactLink").href = "tel:" + contactNumber;
        document.getElementById("whatsAppLink").href = "https://wa.me/" + whatsAppNumber;
        document.getElementById("whatsAppLink").innerText = "Ø§Ø·Ù„Ø¨ ÙƒÙˆØ¯ Ù„Ù„Ø¯Ø®ÙˆÙ„";
        localStorage.setItem("adminCode", adminCode);
        localStorage.setItem("editorCode", editorCode);
        localStorage.setItem("visitorCode", visitorCode);
        localStorage.setItem("contactNumber", contactNumber);
        localStorage.setItem("whatsAppNumber", whatsAppNumber);
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ù†Ø¬Ø§Ø­!");
        closePermissionsModal();
      };
      
      /***************** Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ *******************/
      window.currentMemberElement = null;
      window.showInfo = function(element) {
        currentMemberElement = element;
        const li = element.closest("li");
        document.getElementById("infoName").innerText = li.dataset.name || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
        document.getElementById("infoBirth").innerText = li.dataset.birth || "";
        document.getElementById("infoDeath").innerText = li.dataset.death || "";
        document.getElementById("infoLocation").innerText = li.dataset.location || "";
        document.getElementById("infoImage").src = li.dataset.image || "https://via.placeholder.com/100";
        document.getElementById("infoBox").style.display = "block";
        document.getElementById("editForm").style.display = "none";
      };
      window.closeInfo = function() {
        document.getElementById("infoBox").style.display = "none";
      };
      window.openEditForm = function() {
        if(userRole === "visitor") return;
        const li = currentMemberElement.closest("li");
        document.getElementById("editName").value = li.dataset.name || "";
        document.getElementById("editBirth").value = li.dataset.birth || "";
        document.getElementById("editDeath").value = li.dataset.death || "";
        document.getElementById("editLocation").value = li.dataset.location || "";
        document.getElementById("editImageFile").value = "";
        document.getElementById("editForm").style.display = "block";
      };
      window.closeEditForm = function() {
        document.getElementById("editForm").style.display = "none";
      };
      window.saveEdit = function() {
        const li = currentMemberElement.closest("li");
        li.dataset.name = document.getElementById("editName").value.trim() || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
        li.dataset.birth = document.getElementById("editBirth").value.trim() || "";
        li.dataset.death = document.getElementById("editDeath").value.trim() || "";
        li.dataset.location = document.getElementById("editLocation").value.trim() || "";
        const fileInput = document.getElementById("editImageFile");
        if(fileInput.files && fileInput.files[0]) {
          const file = fileInput.files[0];
          const reader = new FileReader();
          reader.onload = function(e) {
            li.dataset.image = e.target.result;
            currentMemberElement.innerText = li.dataset.name;
            showInfo(currentMemberElement);
            closeEditForm();
          };
          reader.readAsDataURL(file);
        } else {
          currentMemberElement.innerText = li.dataset.name;
          showInfo(currentMemberElement);
          closeEditForm();
        }
      };
      
      /***************** Ø¥Ø¶Ø§ÙØ© Ø§Ø¨Ù† *******************/
      window.currentParentLI = null;
      window.openAddChildForm = function(btn) {
        if(userRole === "visitor") return;
        event.stopPropagation();
        currentParentLI = btn.closest("li");
        document.getElementById("addChildForm").style.display = "block";
      };
      window.closeAddChildForm = function() {
        document.getElementById("addChildForm").style.display = "none";
      };
      window.saveChild = function() {
        const name = document.getElementById("childName").value.trim();
        const birth = document.getElementById("childBirth").value.trim();
        const death = document.getElementById("childDeath").value.trim();
        const location = document.getElementById("childLocation").value.trim();
        const image = document.getElementById("childImage").value.trim();
        if(!name) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…"); return; }
        const newId = Date.now();
        let childUL = currentParentLI.querySelector("ul");
        if(!childUL) {
          childUL = document.createElement("ul");
          currentParentLI.appendChild(childUL);
        }
        const newLI = document.createElement("li");
        newLI.setAttribute("data-id", newId);
        newLI.setAttribute("data-parent", currentParentLI.dataset.id);
        newLI.setAttribute("data-name", name);
        newLI.setAttribute("data-birth", birth);
        newLI.setAttribute("data-death", death);
        newLI.setAttribute("data-location", location);
        newLI.setAttribute("data-image", image || "https://via.placeholder.com/100");
        const memberDiv = document.createElement("div");
        memberDiv.className = "member-box";
        memberDiv.innerText = name;
        memberDiv.onclick = function() { showInfo(memberDiv); };
        const addBtn = document.createElement("button");
        addBtn.className = "add-child-btn";
        addBtn.innerText = "ğŸƒ Ø¥Ø¶Ø§ÙØ© Ø§Ø¨Ù†";
        addBtn.onclick = function(ev) {
          ev.stopPropagation();
          openAddChildForm(addBtn);
        };
        newLI.appendChild(memberDiv);
        newLI.appendChild(document.createElement("br"));
        newLI.appendChild(addBtn);
        const newChildUL = document.createElement("ul");
        newLI.appendChild(newChildUL);
        childUL.appendChild(newLI);
        document.getElementById("childName").value = "";
        document.getElementById("childBirth").value = "";
        document.getElementById("childDeath").value = "";
        document.getElementById("childLocation").value = "";
        document.getElementById("childImage").value = "";
        closeAddChildForm();
        updatePermissions();
      };
      
      /***************** ØªØºÙŠÙŠØ± Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª *******************/
      window.toggleColorPanel = function() {
        var panel = document.getElementById("colorPanel");
        if(panel.style.display === "none" || panel.style.display === ""){
          panel.style.display = "flex";
          panel.style.flexWrap = "wrap";
          panel.style.justifyContent = "center";
          panel.style.gap = "10px";
        } else {
          panel.style.display = "none";
        }
      };
      window.changeIconColor = function(colorStart, colorEnd) {
        document.documentElement.style.setProperty('--icon-bg', `linear-gradient(135deg, ${colorStart}, ${colorEnd})`);
        document.documentElement.style.setProperty('--icon-bg-hover', `linear-gradient(135deg, ${shadeColor(colorStart, -20)}, ${shadeColor(colorEnd, -20)})`);
      };
      window.shadeColor = function(color, percent) {
        let f = parseInt(color.slice(1), 16),
            t = percent < 0 ? 0 : 255,
            p = percent < 0 ? percent * -1 : percent;
        let R = f >> 16, G = f >> 8 & 0x00FF, B = f & 0x0000FF;
        return "#" + (0x1000000 + (Math.round((t - R) * p / 100) + R) * 0x10000 +
          (Math.round((t - G) * p / 100) + G) * 0x100 +
          (Math.round((t - B) * p / 100) + B)).toString(16).slice(1);
      };
    });
  </script>
</body>
</html>
